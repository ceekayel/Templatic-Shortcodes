(function(a){a.extend(a.fn,{livequery:function(e,d,f){var c=this,b;if(a.isFunction(e)){f=d,d=e,e=undefined}a.each(a.livequery.queries,function(g,h){if(c.selector==h.selector&&c.context==h.context&&e==h.type&&(!d||d.$lqguid==h.fn.$lqguid)&&(!f||f.$lqguid==h.fn2.$lqguid)){return(b=h)&&false}});b=b||new a.livequery(this.selector,this.context,e,d,f);b.stopped=false;b.run();return this},expire:function(d,c,e){var b=this;if(a.isFunction(d)){e=c,c=d,d=undefined}a.each(a.livequery.queries,function(g,f){if(b.selector==f.selector&&b.context==f.context&&(!d||d==f.type)&&(!c||c.$lqguid==f.fn.$lqguid)&&(!e||e.$lqguid==f.fn2.$lqguid)&&!this.stopped){a.livequery.stop(f.id)}});return this}});a.livequery=function(e,d,f,c,b){this.selector=e;this.context=d;this.type=f;this.fn=c;this.fn2=b;this.elements=[];this.stopped=false;this.id=a.livequery.queries.push(this)-1;c.$lqguid=c.$lqguid||a.livequery.guid++;if(b){b.$lqguid=b.$lqguid||a.livequery.guid++}return this};a.livequery.prototype={stop:function(){var b=this;if(this.type){this.elements.unbind(this.type,this.fn)}else{if(this.fn2){this.elements.each(function(c,d){b.fn2.apply(d)})}}this.elements=[];this.stopped=true},run:function(){if(this.stopped){return}var d=this;var c=this.elements,e=a(this.selector,this.context),b=e.not(c);this.elements=e;if(this.type){b.bind(this.type,this.fn);if(c.length>0){a.each(c,function(g,f){if(a.inArray(f,e)<0){a.event.remove(f,d.type,d.fn)}})}}else{b.each(function(){d.fn.apply(this)});if(this.fn2&&c.length>0){a.each(c,function(g,f){if(a.inArray(f,e)<0){d.fn2.apply(f)}})}}}};a.extend(a.livequery,{guid:0,queries:[],queue:[],running:false,timeout:null,checkQueue:function(){if(a.livequery.running&&a.livequery.queue.length){var b=a.livequery.queue.length;while(b--){a.livequery.queries[a.livequery.queue.shift()].run()}}},pause:function(){a.livequery.running=false},play:function(){a.livequery.running=true;a.livequery.run()},registerPlugin:function(){a.each(arguments,function(c,b){if(!a.fn[b]){return}var d=a.fn[b];a.fn[b]=function(){var e=d.apply(this,arguments);a.livequery.run();return e}})},run:function(b){if(b!=undefined){if(a.inArray(b,a.livequery.queue)<0){a.livequery.queue.push(b)}}else{a.each(a.livequery.queries,function(c){if(a.inArray(c,a.livequery.queue)<0){a.livequery.queue.push(c)}})}if(a.livequery.timeout){clearTimeout(a.livequery.timeout)}a.livequery.timeout=setTimeout(a.livequery.checkQueue,20)},stop:function(b){if(b!=undefined){a.livequery.queries[b].stop()}else{a.each(a.livequery.queries,function(c){a.livequery.queries[c].stop()})}}});a.livequery.registerPlugin("append","prepend","after","before","wrap","attr","removeAttr","addClass","removeClass","toggleClass","empty","remove","html");a(function(){a.livequery.play()})})(jQuery);jQuery.fn.appendo=function(a){this.each(function(){jQuery.appendo.init(this,a)});return this};jQuery.appendo=function(){var a=this;this.opt={};this.init=function(v,z){function e(){var c=y.clone(k.copyHandlers);c.appendTo(v);B(1);if(typeof k.onAdd=="function"){k.onAdd(c)}if(!!k.focusFirst){c.find("input:first").focus()}}function g(){var c=jQuery(v).find(k.subSelect);if(typeof k.onDel!="function"||k.onDel(c)){c.remove();B(-1)}}function B(c){m=m+(c||0);k.allowDelete&&m>1?w.show():w.hide()}function b(c){return jQuery("<button />").css(k.buttonStyle).html(c)}function x(c){c.stopPropagation();c.preventDefault();return false}function q(c){if(!k.maxRows||m<k.maxRows){e()}return x(c)}function j(c){if(m>1){g()}return x(c)}var k=jQuery.extend({labelAdd:"Add Row",labelDel:"Remove",allowDelete:true,copyHandlers:false,focusFirst:true,onAdd:function(){return true},onDel:function(){return true},maxRows:0,wrapClass:"appendoButtons",wrapStyle:{padding:".4em .2em .5em"},buttonStyle:{marginRight:".5em"},subSelect:"tr:last"},a.opt,z);var y=jQuery(v).find(k.subSelect).clone(k.copyHandlers);var m=1;var A=jQuery(".button-secondary").click(q),w=b(k.labelDel).click(j).hide();B()};return this}();jQuery.noConflict();jQuery(document).ready(function(a){var b={loadVals:function(){var c=a("#templ_shortcode").text(),d=c;a(".templ_input").each(function(){var f=a(this),g=f.attr("id"),g=g.replace("templ_",""),e=new RegExp("{{"+g+"}}","g");d=d.replace(e,f.val())});a("#templ_hidden").remove();a("#templ_form_table").prepend('<div id="templ_hidden" class="hidden">'+d+"</div>")},cLoadVals:function(){var c=a("#templ_child_shortcode").text(),d="";shortcodes="";a("tbody#child-clone-row").each(function(){var e=a(this),f=c;a(".templ_child_input",this).each(function(){var g=a(this),h=g.attr("id"),h=h.replace("templ_","");re=new RegExp("{{"+h+"}}","g");f=f.replace(re,g.val())});shortcodes=shortcodes+f+"\n"});a("#templ_child_shortcodes").remove();a("#templ_child_clone").prepend('<div id="templ_child_shortcodes" class="hidden">'+shortcodes+"</div>");this.loadVals();d=a("#templ_hidden").text().replace("{{child_shortcode}}",shortcodes);a("#templ_hidden").remove();a("#templ_form_table").prepend('<div id="templ_hidden" class="hidden">'+d+"</div>")},children:function(){a("#templ_child_clone").appendo({subSelect:"#child-clone-row",allowDelete:true});a(".deletion").live("click",function(){if(a("#templ_child_clone tbody#child-clone-row").length>1){a("#templ_child_clone tbody:last").remove()}else{alert("You need a minimum of one tab")}return false});a("#child-clone-row").sortable({placeholder:"sortable-placeholder",items:".form-field"})},resizeTB:function(){var d=a("#TB_ajaxContent"),c=a("#TB_window"),e=a("#templ_popup_form");c.css({height:e.outerHeight()+50,width:e.outerWidth(),marginLeft:-(e.outerWidth()/2)});d.css({paddingTop:0,paddingLeft:0,paddingRight:0,height:c.outerHeight()-47,overflow:"auto",width:e.outerWidth()})},load:function(){var e=this,g=a("#templ_popup_form"),c=a("#templ_shortcode_form",g),f=a("#templ_shortcode",c).text(),d=a("#templ_popup",c).text(),h="";e.resizeTB();a(window).resize(function(){e.resizeTB()});e.loadVals();e.children();e.cLoadVals();a(".templ_child_input",c).live("change",function(){e.cLoadVals()});a(".templ_input",c).change(function(){e.loadVals()});a("#code-insert",c).click(function(){var i=window.tinyMCE.majorVersion;if(window.tinyMCE){if(i>="4"){window.tinyMCE.execCommand("mceInsertContent",false,a("#templ_hidden",c).html())}else{alert("else");window.tinyMCE.execInstanceCommand("content","mceInsertContent",false,a("#templ_hidden",c).html())}tb_remove()}})}};jQuery("#templ_popup_form").livequery(function(){b.load()})});
